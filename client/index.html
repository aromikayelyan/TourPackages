<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TravelLab ‚Äî —Ç—É—Ä—ã, –æ—Ç–∑—ã–≤—ã –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç</title>
  <meta name="description" content="–û–¥–Ω–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞: —Å–ø–∏—Å–æ–∫ —Ç—É—Ä–æ–≤, –¥–µ—Ç–∞–ª–∏, –æ—Ç–∑—ã–≤—ã –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–æ–≤, —É–¥–∞–ª–µ–Ω–∏–µ, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Aviasales." />
  <style>
    :root{
      --bg:#0f1221;          /* —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω */
      --card:#171a2b;        /* —Ñ–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ */
      --muted:#8b90a7;       /* –≤—Ç–æ—Ä–∏—á–Ω—ã–π —Ç–µ–∫—Å—Ç */
      --text:#e8ebff;        /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç */
      --brand:#7c5cff;       /* –∞–∫—Ü–µ–Ω—Ç */
      --brand-2:#3bd9d9;     /* –≤—Ç–æ—Ä–æ–π –∞–∫—Ü–µ–Ω—Ç */
      --danger:#ff6363;
      --success:#41d689;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 1200px at 110% -10%, rgba(124,92,255,.25), transparent 45%),
                         radial-gradient(900px 900px at -10% 110%, rgba(59,217,217,.2), transparent 45%),
                         var(--bg);
         color:var(--text);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial}
    a{color:inherit}
    .container{max-width:1100px;margin:0 auto;padding:24px}

    /* Topbar */
    .topbar{position:sticky;top:0;z-index:20;background:rgba(15,18,33,.7);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.06)}
    .topbar-inner{display:flex;align-items:center;gap:16px;justify-content:space-between;padding:14px 24px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px}
    .logo .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg,var(--brand),var(--brand-2))}
    nav a, nav select{padding:10px 14px;border-radius:10px;color:var(--muted);text-decoration:none;background:transparent;border:1px solid rgba(255,255,255,.08)}
    nav a.active, nav a:hover{color:var(--text);background:rgba(124,92,255,.16)}

    /* Blocks */
    .hero{display:grid;gap:12px;padding:28px 0 10px}
    .hero h1{font-size:clamp(26px,5vw,38px);margin:0}
    .hero p{margin:0;color:var(--muted)}

    .toolbar{display:flex;gap:12px;flex-wrap:wrap;margin:18px 0}
    .input, select{background:#12162a;border:1px solid rgba(255,255,255,.08);color:var(--text);padding:10px 12px;border-radius:12px;outline:none;min-width:200px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:linear-gradient(180deg,rgba(124,92,255,.22),rgba(124,92,255,.12));color:var(--text);cursor:pointer;transition:transform .08s ease;}
    .btn:hover{transform:translateY(-1px)}
    .btn.secondary{background:#12162a}
    .btn.danger{background:linear-gradient(180deg, rgba(255,99,99,.22), rgba(255,99,99,.12));border-color:rgba(255,99,99,.25)}
    .btn.success{background:linear-gradient(180deg, rgba(65,214,137,.22), rgba(65,214,137,.12));border-color:rgba(65,214,137,.25)}

    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .card .media{position:relative;aspect-ratio:16/10;overflow:hidden}
    .card img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .6s ease}
    .card:hover img{transform:scale(1.06)}
    .badge{position:absolute;left:12px;top:12px;background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.15);padding:6px 10px;border-radius:999px;font-size:12px}
    .card .content{padding:14px 14px 16px;display:flex;flex-direction:column;gap:8px}
    .title{font-weight:700}
    .muted{color:var(--muted)}

    .section{margin:28px 0}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0));border:1px solid rgba(255,255,255,.1);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)}

    .split{display:grid;gap:20px;grid-template-columns:1.2fr .8fr}
    @media (max-width:860px){.split{grid-template-columns:1fr}}

    .gallery{display:grid;gap:10px;grid-template-columns:repeat(3,1fr)}
    .gallery img{width:100%;height:160px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)}

    .review{padding:12px;border:1px solid rgba(255,255,255,.08);border-radius:14px;background:rgba(255,255,255,.03)}

    .empty{padding:20px;text-align:center;color:var(--muted)}

    .footer{margin:40px 0 20px;color:var(--muted);text-align:center;font-size:14px}

    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:999px;font-size:12px}

    .warning{color:var(--danger)}
    .hint{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner container">
      <div class="logo" onclick="Router.go('/')" style="cursor:pointer">
        <span class="dot"></span>
        <span id="brandTitle">TravelLab</span>
      </div>
      <nav style="display:flex; gap:8px; align-items:center">
        <a href="#/" data-link id="navTours">–¢—É—Ä—ã</a>
        <a href="#/admin" data-link id="navAdd">–î–æ–±–∞–≤–∏—Ç—å —Ç—É—Ä</a>
        <select id="langSelect" aria-label="Language">
          <option value="ru">üá∑üá∫ –†—É—Å</option>
          <option value="en">üá¨üáß Eng</option>
          <option value="hy">üá¶üá≤ ’Ä’°’µ</option>
        </select>
      </nav>
    </div>
  </header>

  <main id="app" class="container"></main>

  <footer class="footer container">
    <span id="footerText">–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è.</span>
  </footer>

<script>
// =========================
// üåê I18N ‚Äî —Ç—Ä–∏ —è–∑—ã–∫–∞: RU / EN / HY
// =========================
const I18N = {
  ru: {
    brand: 'TravelLab',
    footer: '–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è.',
    nav: { tours: '–¢—É—Ä—ã', add: '–î–æ–±–∞–≤–∏—Ç—å —Ç—É—Ä' },
    hero: { title: '–ü–æ–¥–±–µ—Ä–∏ –∏–¥–µ–∞–ª—å–Ω—ã–π —Ç—É—Ä', sub: '–°–º–æ—Ç—Ä–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –∏–∑—É—á–∞–π –¥–µ—Ç–∞–ª–∏ –∏ –æ—Å—Ç–∞–≤–ª—è–π –æ—Ç–∑—ã–≤—ã –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.' },
    toolbar: { search: '–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é‚Ä¶', refresh: '–û–±–Ω–æ–≤–∏—Ç—å', add: '+ –î–æ–±–∞–≤–∏—Ç—å —Ç—É—Ä' },
    sort: { popular: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ', cheap: '–°–Ω–∞—á–∞–ª–∞ –¥–µ—à—ë–≤—ã–µ', expensive: '–°–Ω–∞—á–∞–ª–∞ –¥–æ—Ä–æ–≥–∏–µ', recent: '–ü–æ –¥–∞—Ç–µ –Ω–∞—á–∞–ª–∞' },
    empty: { list: '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å.', images: '–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π', reviews: '–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ ‚Äî —Å—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º!' },
    labels: { duration: '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', seats: '–°–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç', start: '–°—Ç–∞—Ä—Ç', end: '–§–∏–Ω–∏—à', price: '–¶–µ–Ω–∞', hit: '–•–∏—Ç', tour: '–¢—É—Ä', available: '–î–æ—Å—Ç—É–ø–Ω–æ –º–µ—Å—Ç', rating: '–†–µ–π—Ç–∏–Ω–≥' },
    actions: { details: '–ü–æ–¥—Ä–æ–±–Ω–µ–µ', del: '–£–¥–∞–ª–∏—Ç—å', delConfirm: '–£–¥–∞–ª–∏—Ç—å —Ç—É—Ä?', delOk: '–£–¥–∞–ª–µ–Ω–æ', delErr: '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ', loading: '–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶', thanks: '–°–ø–∞—Å–∏–±–æ! –û—Ç–∑—ã–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.', err: '–û—à–∏–±–∫–∞: ' },
    tour: { notFound: '–¢—É—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω', descSoon: '–û–ø–∏—Å–∞–Ω–∏–µ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç' },
    reviews: { title: '–û—Ç–∑—ã–≤—ã', leave: '–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤', name: '–í–∞—à–µ –∏–º—è', comment: '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π', rate: '–û—Ü–µ–Ω–∫–∞ (1‚Äì5)', send: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å', reset: '–°–±—Ä–æ—Å–∏—Ç—å' },
    avia: { title: '–î–æ–±—Ä–∞—Ç—å—Å—è –¥–æ –º–µ—Å—Ç–∞ (Aviasales)', desc: '–î–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π ID –Ω–∏–∂–µ. –ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω—É—é Aviasales.', from: '–û—Ç–∫—É–¥–∞ (–≥–æ—Ä–æ–¥)', to: '–ö—É–¥–∞ (–≥–æ—Ä–æ–¥/—Å—Ç—Ä–∞–Ω–∞)', date: '–î–∞—Ç–∞', find: '–ù–∞–π—Ç–∏ –±–∏–ª–µ—Ç—ã', partner: '–ü–∞—Ä—Ç–Ω—ë—Ä' },
    admin: { title: '–î–æ–±–∞–≤–∏—Ç—å —Ç—É—Ä', name: '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–∞', description: '–ö–æ—Ä–æ—Ç–∫–æ –æ –ø—Ä–æ–≥—Ä–∞–º–º–µ', price: '–¶–µ–Ω–∞', seats: '–î–æ—Å—Ç—É–ø–Ω–æ –º–µ—Å—Ç', duration: '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', forSlide: '–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∫–∞–∫ —Ö–∏—Ç (forSlide)', yes: '–î–∞', no: '–ù–µ—Ç', start: '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞', end: '–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è', images: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ 3 —à—Ç.)', save: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å', cancel: '–û—Ç–º–µ–Ω–∞', sending: '–û—Ç–ø—Ä–∞–≤–∫–∞‚Ä¶', added: '–¢—É—Ä –¥–æ–±–∞–≤–ª–µ–Ω!', error: '–û—à–∏–±–∫–∞: ' },
  },
  en: {
    brand: 'TravelLab',
    footer: 'Built with ‚ù§Ô∏è.',
    nav: { tours: 'Tours', add: 'Add tour' },
    hero: { title: 'Find your perfect tour', sub: 'Browse deals, explore details and leave reviews without signing up.' },
    toolbar: { search: 'Search by name‚Ä¶', refresh: 'Refresh', add: '+ Add tour' },
    sort: { popular: 'Popular', cheap: 'Cheapest first', expensive: 'Most expensive first', recent: 'By start date' },
    empty: { list: 'Nothing found. Try another query.', images: 'No images', reviews: 'No reviews yet ‚Äî be the first!' },
    labels: { duration: 'Duration', seats: 'Seats left', start: 'Start', end: 'End', price: 'Price', hit: 'Hit', tour: 'Tour', available: 'Available seats', rating: 'Rating' },
    actions: { details: 'Details', del: 'Delete', delConfirm: 'Delete this tour?', delOk: 'Deleted', delErr: 'Delete error: ', loading: 'Loading‚Ä¶', thanks: 'Thanks! Review sent.', err: 'Error: ' },
    tour: { notFound: 'Tour not found', descSoon: 'Description coming soon' },
    reviews: { title: 'Reviews', leave: 'Leave a review', name: 'Your name', comment: 'Comment', rate: 'Rating (1‚Äì5)', send: 'Send', reset: 'Reset' },
    avia: { title: 'Get there (Aviasales)', desc: 'Put your partner ID below or just open Aviasales home.', from: 'From (city)', to: 'To (city/country)', date: 'Date', find: 'Find tickets', partner: 'Partner' },
    admin: { title: 'Add tour', name: 'Tour name', description: 'Short description', price: 'Price', seats: 'Seats available', duration: 'Duration', forSlide: 'Show as hit (forSlide)', yes: 'Yes', no: 'No', start: 'Start date', end: 'End date', images: 'Images (up to 3)', save: 'Save', cancel: 'Cancel', sending: 'Sending‚Ä¶', added: 'Tour added!', error: 'Error: ' },
  },
  hy: {
    brand: 'TravelLab',
    footer: '’ç’ø’•’≤’Æ’æ’°’Æ ’Ω’´÷Ä’∏’æ ‚ù§Ô∏è',
    nav: { tours: '’è’∏÷Ç÷Ä’•÷Ä', add: '‘±’æ’•’¨’°÷Å’∂’•’¨ ’ø’∏÷Ç÷Ä’®' },
    hero: { title: '‘≥’ø’´÷Ä ’´’§’•’°’¨’°’Ø’°’∂ ’ø’∏÷Ç÷Ä’®', sub: '‘¥’´’ø’´÷Ä ’°’º’°’ª’°÷Ä’Ø’∂’•÷Ä’®, ’Æ’°’∂’∏’©’°÷Å’´÷Ä ’¥’°’∂÷Ä’°’¥’°’Ω’∂’•÷Ä’´’∂ ÷á ’©’∏’≤ ’°÷Ä’±’°’£’°’∂÷Ñ ’°’º’°’∂÷Å ’£÷Ä’°’∂÷Å’¥’°’∂÷â' },
    toolbar: { search: '’à÷Ä’∏’∂’∏÷Ç’¥ ’®’Ω’ø ’°’∂’æ’°’∂‚Ä¶', refresh: '‘π’°÷Ä’¥’°÷Å’∂’•’¨', add: '+ ‘±’æ’•’¨’°÷Å’∂’•’¨ ’ø’∏÷Ç÷Ä' },
    sort: { popular: '’Ä’°’∂÷Ä’°’≥’°’∂’°’π', cheap: '’Ñ –¥–µ—à–µ–≤—ã–µ ’Ω’Ø’¶’¢’´÷Å', expensive: '‘±’¥’•’∂’°’©’°’∂’Ø’•÷Ä ’Ω’Ø’¶’¢’´÷Å', recent: '’ç’Ø’´’¶’¢ ’®’Ω’ø ’°’¥’Ω’°’©’æ’´' },
    empty: { list: '’à’π’´’∂’π ’π’´ ’£’ø’∂’æ’•’¨÷â ’ì’∏÷Ä’±’´÷Ä ’°’µ’¨ ’∞’°÷Ä÷Å’∏÷Ç’¥÷â', images: '’Ü’Ø’°÷Ä’∂’•÷Ä ’π’Ø’°’∂', reviews: '‘¥’•’º÷á’Ω ’Ø’°÷Ä’Æ’´÷Ñ’∂’•÷Ä ’π’Ø’°’∂ ‚Äî ’•’≤’´÷Ä ’°’º’°’ª’´’∂’®!' },
    labels: { duration: '’è÷á’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂', seats: '‘±’¶’°’ø ’ø’•’≤’•÷Ä', start: '’ç’Ø’´’¶’¢', end: '‘±’æ’°÷Ä’ø', price: '‘≥’´’∂', hit: '’Ä’´’©', tour: '’è’∏÷Ç÷Ä', available: '‘±’º’Ø’° ’ø’•’≤’•÷Ä', rating: '’é’°÷Ä’Ø’°’∂’´’∑' },
    actions: { details: '’Ñ’°’∂÷Ä’°’¥’°’Ω’∂', del: '’ã’∂’ª’•’¨', delConfirm: '’ã’∂’ª’•’û’¨ ’ø’∏÷Ç÷Ä’®', delOk: '’ã’∂’ª’æ’•÷Å', delErr: '’ã’∂’ª’¥’°’∂ ’Ω’≠’°’¨: ', loading: '‘≤’•’º’∂’æ’∏÷Ç’¥ ’ß‚Ä¶', thanks: '’á’∂’∏÷Ä’∞’°’Ø’°’¨’∏÷Ç’©’µ’∏÷Ç’∂! ‘ø’°÷Ä’Æ’´÷Ñ’® ’∏÷Ç’≤’°÷Ä’Ø’æ’•÷Å÷â', err: '’ç’≠’°’¨: ' },
    tour: { notFound: '’è’∏÷Ç÷Ä’® ’π’´ ’£’ø’∂’æ’•’¨', descSoon: '’Ü’Ø’°÷Ä’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂’® ’∑’∏÷Ç’ø’∏’æ' },
    reviews: { title: '‘ø’°÷Ä’Æ’´÷Ñ’∂’•÷Ä', leave: '‘π’∏’≤’∂’•’¨ ’Ø’°÷Ä’Æ’´÷Ñ', name: '’Å’•÷Ä ’°’∂’∏÷Ç’∂’®', comment: '’Ñ’•’Ø’∂’°’¢’°’∂’∏÷Ç’©’µ’∏÷Ç’∂', rate: '‘≥’∂’°’∞’°’ø’°’Ø’°’∂ (1‚Äì5)', send: '’à÷Ç’≤’°÷Ä’Ø’•’¨', reset: '’Ñ’°÷Ñ÷Ä’•’¨' },
    avia: { title: '‘ª’∂’π’∫’•’Ω ’∞’°’Ω’∂’•’¨ (Aviasales)', desc: '’Ñ’∏÷Ç’ø÷Ñ’°’£÷Ä’´÷Ä ÷Ñ’∏ ’£’∏÷Ä’Æ’®’∂’Ø’•÷Ä ID‚Äë’∂ ’Ø’°’¥ ’¢’°÷Å Aviasales-’´ ’£’¨’≠’°’æ’∏÷Ä ’ß’ª’®÷â', from: '’à÷Ä’ø’•’≤’´÷Å (÷Ñ’°’≤’°÷Ñ)', to: '’à÷Ä’ø’•’≤ (÷Ñ’°’≤’°÷Ñ/’•÷Ä’Ø’´÷Ä)', date: '‘±’¥’Ω’°’©’´’æ', find: '‘≥’ø’∂’•’¨ ’ø’∏’¥’Ω’•÷Ä', partner: '‘≥’∏÷Ä’Æ’®’∂’Ø’•÷Ä' },
    admin: { title: '‘±’æ’•’¨’°÷Å’∂’•’¨ ’ø’∏÷Ç÷Ä', name: '’è’∏÷Ç÷Ä’´ ’°’∂’æ’°’∂’∏÷Ç’¥', description: '‘ø’°÷Ä’≥ ’∂’Ø’°÷Ä’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂', price: '‘≥’´’∂', seats: '‘±’¶’°’ø ’ø’•’≤’•÷Ä', duration: '’è÷á’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂', forSlide: '’ë’∏÷Ç÷Å’°’§÷Ä’•’¨ ’∏÷Ä’∫’•’Ω ’∞’´’© (forSlide)', yes: '‘±’µ’∏', no: '’à’π', start: '’ç’Ø’´’¶’¢’´ ’°’¥’Ω’°’©’´’æ', end: '‘±’æ’°÷Ä’ø’´ ’°’¥’Ω’°’©’´’æ', images: '’Ü’Ø’°÷Ä’∂’•÷Ä (’¥’´’∂’π÷á 3 ’∞’°’ø)', save: '’ä’°’∞’∫’°’∂’•’¨', cancel: '’â’•’≤’°÷Ä’Ø’•’¨', sending: '’à÷Ç’≤’°÷Ä’Ø’æ’∏÷Ç’¥ ’ß‚Ä¶', added: '’è’∏÷Ç÷Ä’® ’°’æ’•’¨’°÷Å’æ’•÷Å!', error: '’ç’≠’°’¨: ' },
  }
}

function getLang(){
  return localStorage.getItem('lang') || 'ru'
}
function setLang(l){
  localStorage.setItem('lang', l)
  document.documentElement.lang = l
  document.getElementById('langSelect').value = l
  // –æ–±–Ω–æ–≤–∏–º —à–∞–ø–∫—É/—Ç–∏—Ç–ª
  const L = I18N[l]
  document.getElementById('navTours').textContent = L.nav.tours
  document.getElementById('navAdd').textContent = L.nav.add
  document.getElementById('brandTitle').textContent = L.brand
  document.getElementById('footerText').textContent = L.footer
  document.title = `${L.brand} ‚Äî ${L.nav.tours}`
  Router.resolve() // –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
}
function t(path){
  const L = I18N[getLang()]
  return path.split('.').reduce((o,k)=> (o&&o[k]!=null? o[k]: ''), L) || ''
}
function validateTranslations(){
  const needed = [
    'nav.tours','nav.add','hero.title','hero.sub','toolbar.search','toolbar.refresh','toolbar.add',
    'sort.popular','sort.cheap','sort.expensive','sort.recent',
    'empty.list','empty.images','empty.reviews',
    'labels.duration','labels.seats','labels.start','labels.end','labels.price','labels.hit','labels.tour','labels.available','labels.rating',
    'actions.details','actions.del','actions.delConfirm','actions.delOk','actions.delErr','actions.loading','actions.thanks','actions.err',
    'tour.notFound','tour.descSoon',
    'reviews.title','reviews.leave','reviews.name','reviews.comment','reviews.rate','reviews.send','reviews.reset',
    'avia.title','avia.desc','avia.from','avia.to','avia.date','avia.find','avia.partner',
    'admin.title','admin.name','admin.description','admin.price','admin.seats','admin.duration','admin.forSlide','admin.yes','admin.no','admin.start','admin.end','admin.images','admin.save','admin.cancel','admin.sending','admin.added','admin.error'
  ]
  for(const [lang, dict] of Object.entries(I18N)){
    for(const key of needed){
      const ok = key.split('.').reduce((o,k)=> (o&&o[k]!=null? o[k]: undefined), dict)
      if(ok === undefined){ console.warn(`[i18n] Missing key for ${lang}:`, key) }
    }
  }
}

// =========================
// ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ê API
// =========================
const CONFIG = {
  TOURS_BASE: 'http://localhost:4400/packages',
  RATES_BASE: 'http://localhost:4400/rating',
  CURRENCY: '‚ÇΩ',
  AFFILIATE: { PARTNER_ID: 'YOUR_PARTNER_ID', UTM: 'utm_source=travellab&utm_medium=referral&utm_campaign=tour', URL: 'https://www.aviasales.ru' }
}

// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π fetch —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
async function apiFetch(url, options={}){
  try{
    const res = await fetch(url, options)
    if(!res.ok){
      const txt = await res.text().catch(()=> '')
      throw new Error(txt || `HTTP ${res.status}`)
    }
    const ct = res.headers.get('content-type')||''
    return ct.includes('application/json') ? res.json() : res.text()
  }catch(e){
    console.error('API error:', e)
    throw e
  }
}

// =========================
// üß≠ –ú–∏–Ω–∏-—Ä–æ—É—Ç–µ—Ä (hash-based)
// =========================
const Router = {
  routes: {},
  init(){
    window.addEventListener('hashchange', ()=> this.resolve())
    this.resolve()
  },
  register(path, handler){ this.routes[path] = handler },
  go(path){ location.hash = '#' + path },
  resolve(){
    const hash = location.hash.slice(1) || '/'
    const [path] = hash.split('?')

    for(const pattern in this.routes){
      const params = {}
      const pSeg = pattern.split('/').filter(Boolean)
      const hSeg = path.split('/').filter(Boolean)
      if(pSeg.length !== hSeg.length) continue
      let ok = true
      pSeg.forEach((seg,i)=>{
        if(seg.startsWith(':')) params[seg.slice(1)] = decodeURIComponent(hSeg[i])
        else if(seg !== hSeg[i]) ok=false
      })
      if(ok){
        this.routes[pattern](params)
        this.highlightNav(path)
        return
      }
    }
    document.getElementById('app').innerHTML = `<div class="section"><div class="panel"><h2>404</h2><p class="muted">Not found</p></div></div>`
  },
  highlightNav(path){
    document.querySelectorAll('nav a').forEach(a=>{
      const href = a.getAttribute('href')||''
      const p = href.replace('#','')
      a.classList.toggle('active', p === '#' + path || (p==='#/' && path==='/'))
    })
  }
}

// =========================
// üñºÔ∏è –†–ï–ù–î–ï–†–´ –°–¢–†–ê–ù–ò–¶
// =========================
Router.register('/', renderHome)
Router.register('/tour/:id', ({id})=> renderTour(id))
Router.register('/admin', renderAdmin)

async function renderHome(){
  const app = document.getElementById('app')
  app.innerHTML = `
    <section class="hero">
      <h1 id="heroTitle">${t('hero.title')}</h1>
      <p id="heroSub">${t('hero.sub')}</p>
      <div class="toolbar">
        <input id="q" class="input" placeholder="${t('toolbar.search')}" />
        <select id="sort">
          <option value="popular">${t('sort.popular')}</option>
          <option value="cheap">${t('sort.cheap')}</option>
          <option value="expensive">${t('sort.expensive')}</option>
          <option value="recent">${t('sort.recent')}</option>
        </select>
        <button class="btn" id="refreshBtn">${t('toolbar.refresh')}</button>
        <button class="btn secondary" onclick="Router.go('/admin')">${t('toolbar.add')}</button>
      </div>
    </section>
    <section class="section">
      <div id="cards" class="grid"></div>
    </section>
  `

  const q = document.getElementById('q')
  const sortSel = document.getElementById('sort')
  const cards = document.getElementById('cards')
  const refreshBtn = document.getElementById('refreshBtn')

  async function load(){
    cards.innerHTML = `<div class="panel">${t('actions.loading')}</div>`
    try{
      const data = await apiFetch(`${CONFIG.TOURS_BASE}/`)
      let list = Array.isArray(data) ? data : []
      const query = (q.value||'').trim().toLowerCase()
      if(query) list = list.filter(ti => (ti.name||'').toLowerCase().includes(query))
      const sort = sortSel.value
      list.sort((a,b)=>{
        if(sort==='cheap') return (a.price||0)-(b.price||0)
        if(sort==='expensive') return (b.price||0)-(a.price||0)
        if(sort==='recent') return new Date(a.startDate||0) - new Date(b.startDate||0)
        return (b.forSlide?1:0)-(a.forSlide?1:0)
      })

      if(!list.length){
        cards.innerHTML = `<div class='empty panel'>${t('empty.list')}</div>`
        return
      }

      cards.innerHTML = list.map(item=> TourCard(item)).join('')
      cards.querySelectorAll('[data-open]').forEach(btn=>{
        btn.addEventListener('click', ()=> Router.go(`/tour/${btn.getAttribute('data-open')}`))
      })
    }catch(e){
      cards.innerHTML = `<div class='panel warning'>${t('actions.err')}${escapeHtml(e.message)}</div>`
    }
  }

  q.addEventListener('input', debounce(load, 250))
  sortSel.addEventListener('change', load)
  refreshBtn.addEventListener('click', load)
  load()
}

function TourCard(ti){
  const cover = (ti.images && ti.images[0]) || placeholder()
  const price = ti.price ? `${Number(ti.price).toLocaleString()} ${CONFIG.CURRENCY}` : t('labels.price')
  const seats = ti.availableSeats ?? '‚Äî'
  const dur = ti.duration || '‚Äî'
  const badge = ti.forSlide ? t('labels.hit') : t('labels.tour')
  return `
    <article class="card">
      <div class="media">
        <img src="${cover}" alt="${escapeHtml(ti.name||'Tour')}" />
        <span class="badge">${badge}</span>
      </div>
      <div class="content">
        <div class="title">${escapeHtml(ti.name||'‚Äî')}</div>
        <div class="muted">${t('labels.duration')}: ${escapeHtml(dur)} ‚Ä¢ ${t('labels.seats')}: ${escapeHtml(String(seats))}</div>
        <div class="chips">
          ${ti.startDate ? `<span class='chip'>${t('labels.start')}: ${fmtDate(ti.startDate)}</span>`:''}
          ${ti.endDate ? `<span class='chip'>${t('labels.end')}: ${fmtDate(ti.endDate)}</span>`:''}
          <span class="chip">${t('labels.price')}: ${price}</span>
        </div>
        <div style="margin-top:8px;display:flex;gap:10px">
          <button class="btn" data-open="${ti.uid}">${t('actions.details')}</button>
          <button class="btn danger" onclick="handleDelete('${ti.uid}')">${t('actions.del')}</button>
        </div>
      </div>
    </article>
  `
}

async function handleDelete(uid){
  if(!confirm(t('actions.delConfirm'))) return
  try{
    await apiFetch(`${CONFIG.TOURS_BASE}/${encodeURIComponent(uid)}`, { method:'DELETE' })
    alert(t('actions.delOk'))
    Router.go('/')
    renderHome()
  }catch(e){
    alert(t('actions.delErr') + e.message)
  }
}

async function renderTour(uid){
  const app = document.getElementById('app')
  app.innerHTML = `<div class='section'><div class='panel'>${t('actions.loading')}</div></div>`
  try{
    const payload = await apiFetch(`${CONFIG.TOURS_BASE}/${encodeURIComponent(uid)}`)
    const [ti, comments] = payload || []
    if(!ti) throw new Error(t('tour.notFound'))

    const gallery = (ti.images||[]).map(src=> `<img src="${src}" alt="img"/>`).join('') || `<div class='empty'>${t('empty.images')}</div>`
    const avg = (comments||[]).length ? (comments.reduce((s,c)=> s + (c.rate||0),0) / comments.length).toFixed(1) : '‚Äî'

    app.innerHTML = `
      <section class="section">
        <div class="split">
          <div class="panel">
            <div class="gallery">${gallery}</div>
            <h2 style="margin:12px 4px 8px">${escapeHtml(ti.name||'‚Äî')}</h2>
            <p class="muted" style="white-space:pre-wrap">${escapeHtml(ti.description||t('tour.descSoon'))}</p>
            <div class="chips" style="margin-top:10px">
              <span class="chip">${t('labels.price')}: ${ti.price ? `${Number(ti.price).toLocaleString()} ${CONFIG.CURRENCY}` : '‚Äî'}</span>
              ${ti.duration ? `<span class='chip'>${t('labels.duration')}: ${escapeHtml(ti.duration)}</span>`:''}
              ${ti.availableSeats!=null ? `<span class='chip'>${t('labels.available')}: ${escapeHtml(String(ti.availableSeats))}</span>`:''}
              ${ti.startDate ? `<span class='chip'>${t('labels.start')}: ${fmtDate(ti.startDate)}</span>`:''}
              ${ti.endDate ? `<span class='chip'>${t('labels.end')}: ${fmtDate(ti.endDate)}</span>`:''}
              <span class="chip">‚≠ê ${t('labels.rating')}: ${avg}</span>
            </div>

            <div class="section">
              <h3 style="margin:0 0 8px">${t('avia.title')}</h3>
              <div class="panel" style="background:rgba(124,92,255,.06)">
                <p class="muted" style="margin-top:0">${t('avia.desc')}</p>
                <div class="toolbar">
                  <input id="fromCity" class="input" placeholder="${t('avia.from')}" />
                  <input id="toCity" class="input" placeholder="${t('avia.to')}" />
                  <input id="dateFly" class="input" type="date" aria-label="${t('avia.date')}" />
                  <button class="btn" id="flyBtn">${t('avia.find')}</button>
                </div>
                <div class="hint">${t('avia.partner')}: <b>${CONFIG.AFFILIATE.PARTNER_ID}</b> ‚Ä¢ UTM: <code>${CONFIG.AFFILIATE.UTM}</code></div>
              </div>
            </div>
          </div>

          <aside class="panel">
            <h3 style="margin-top:0">${t('reviews.title')}</h3>
            <div id="reviewsWrap">
              ${(comments||[]).length ? comments.map(c=> ReviewItem(c)).join('') : `<div class='empty'>${t('empty.reviews')}</div>`}
            </div>
            <hr style="border-color:rgba(255,255,255,.08);margin:16px 0" />
            <h3 style="margin:0 0 8px">${t('reviews.leave')}</h3>
            <form id="reviewForm" class="section" onsubmit="return false">
              <input required name="userName" class="input" placeholder="${t('reviews.name')}" />
              <textarea required name="comment" class="input" style="min-height:90px" placeholder="${t('reviews.comment')}"></textarea>
              <label class="hint">${t('reviews.rate')}</label>
              <input required name="rate" class="input" type="number" min="1" max="5" value="5" />
              <div style="display:flex;gap:10px;margin-top:10px">
                <button class="btn success" type="submit">${t('reviews.send')}</button>
                <button class="btn secondary" type="reset">${t('reviews.reset')}</button>
              </div>
              <div id="reviewMsg" class="hint" style="margin-top:8px"></div>
            </form>
          </aside>
        </div>
      </section>
    `

    document.getElementById('flyBtn').addEventListener('click', ()=>{
      const base = CONFIG.AFFILIATE.URL
      const utm = CONFIG.AFFILIATE.UTM ? (base.includes('?')? '&':'?') + CONFIG.AFFILIATE.UTM : ''
      window.open(`${base}${utm}`, '_blank')
    })

    const form = document.getElementById('reviewForm')
    const msg = document.getElementById('reviewMsg')
    form.addEventListener('submit', async ()=>{
      msg.textContent = t('admin.sending')
      const payload = Object.fromEntries(new FormData(form).entries())
      payload.rate = Number(payload.rate)
      try{
        await apiFetch(`${CONFIG.RATES_BASE}/${encodeURIComponent(uid)}`,{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) })
        msg.textContent = t('actions.thanks')
        form.reset()
        renderTour(uid)
      }catch(e){
        msg.textContent = t('actions.err') + e.message
      }
    })

  }catch(e){
    app.innerHTML = `<div class='section'><div class='panel warning'>${escapeHtml(e.message)}</div></div>`
  }
}

function ReviewItem(c){
  const stars = '‚òÖ'.repeat(Math.max(1, Math.min(5, Number(c.rate)||0)))
  return `<div class='review'><div><b>${escapeHtml(c.userName||'Anon')}</b> <span class='muted'>${stars}</span></div><div>${escapeHtml(c.comment||'')}</div></div>`
}

function renderAdmin(){
  const app = document.getElementById('app')
  app.innerHTML = `
    <section class="section">
      <div class="panel">
        <h2 style="margin-top:0">${t('admin.title')}</h2>
        <form id="addForm" onsubmit="return false" enctype="multipart/form-data">
          <div class="split">
            <div>
              <label class="hint">${t('admin.name')}</label>
              <input name="name" class="input" required placeholder="${t('admin.name')}" />

              <label class="hint">${t('admin.description')}</label>
              <textarea name="description" class="input" style="min-height:120px" placeholder="${t('admin.description')}"></textarea>

              <div class="toolbar">
                <div style="flex:1">
                  <label class="hint">${t('admin.price')}</label>
                  <input name="price" class="input" type="number" min="0" placeholder="50000" />
                </div>
                <div style="flex:1">
                  <label class="hint">${t('admin.seats')}</label>
                  <input name="availableSeats" class="input" type="number" min="0" placeholder="12" />
                </div>
              </div>

              <div class="toolbar">
                <div style="flex:1">
                  <label class="hint">${t('admin.duration')}</label>
                  <input name="duration" class="input" placeholder="7 –¥–Ω–µ–π / 6 –Ω–æ—á–µ–π" />
                </div>
                <div style="flex:1">
                  <label class="hint">${t('admin.forSlide')}</label>
                  <select name="forSlide" class="input">
                    <option value="false">${t('admin.no')}</option>
                    <option value="true">${t('admin.yes')}</option>
                  </select>
                </div>
              </div>

              <div class="toolbar">
                <div style="flex:1">
                  <label class="hint">${t('admin.start')}</label>
                  <input name="startDate" class="input" type="date" />
                </div>
                <div style="flex:1">
                  <label class="hint">${t('admin.end')}</label>
                  <input name="endDate" class="input" type="date" />
                </div>
              </div>
            </div>

            <div>
              <label class="hint">${t('admin.images')}</label>
              <input name="images" class="input" type="file" accept="image/*" multiple />
              <div id="preview" class="gallery" style="margin-top:10px"></div>
            </div>
          </div>
          <div style="display:flex;gap:10px;margin-top:16px">
            <button class="btn success" type="submit">${t('admin.save')}</button>
            <button class="btn secondary" type="button" onclick="Router.go('/')">${t('admin.cancel')}</button>
          </div>
          <div id="addMsg" class="hint" style="margin-top:8px"></div>
        </form>
      </div>
    </section>
  `

  const fileInput = document.querySelector('input[name="images"]')
  const preview = document.getElementById('preview')
  fileInput.addEventListener('change', ()=>{
    preview.innerHTML = ''
    const files = Array.from(fileInput.files||[]).slice(0,3)
    files.forEach(f=>{
      const url = URL.createObjectURL(f)
      const img = document.createElement('img')
      img.src = url
      preview.appendChild(img)
    })
  })

  const form = document.getElementById('addForm')
  const msg = document.getElementById('addMsg')
  form.addEventListener('submit', async ()=>{
    msg.textContent = t('admin.sending')
    try{
      const fd = new FormData(form)
      const imgs = Array.from(fileInput.files||[]).slice(0,3)
      fd.delete('images')
      imgs.forEach(f=> fd.append('images', f))

      const res = await fetch(`${CONFIG.TOURS_BASE}/`, { method:'POST', body: fd })
      if(!res.ok){ throw new Error(await res.text()) }
      msg.textContent = t('admin.added')
      setTimeout(()=> Router.go('/'), 600)
    }catch(e){
      msg.textContent = t('admin.error') + (e.message||'')
    }
  })
}

// =========================
// üîß –£—Ç–∏–ª–∏—Ç—ã
// =========================
function fmtDate(d){ try{ return new Date(d).toLocaleDateString(getLang()==='en'?'en-GB':(getLang()==='hy'?'hy-AM':'ru-RU')) }catch{ return d } }
function escapeHtml(str){ return String(str).replace(/[&<>"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])) }
function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms) } }
function placeholder(){ const svg = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='800' height='500'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop stop-color='%237c5cff' offset='0'/><stop stop-color='%233bd9d9' offset='1'/></linearGradient></defs><rect width='100%' height='100%' fill='url(%23g)'/><text x='50%' y='52%' font-family='Verdana' font-size='36' fill='white' text-anchor='middle'>TravelLab</text></svg>`); return `data:image/svg+xml;utf8,${svg}` }

// === –°—Ç–∞—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è + –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–∞
(function init(){
  validateTranslations()
  const sel = document.getElementById('langSelect')
  sel.addEventListener('change', (e)=> setLang(e.target.value))
  setLang(getLang())
  Router.init()
})();
</script>
</body>
</html>
